<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>f4) Analysis walthrough: Nested ANOVA • shroom</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="f4) Analysis walthrough: Nested ANOVA">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">shroom</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a1-introduction.html">a1) Introduction to the shroom package</a>
    </li>
    <li>
      <a href="../articles/a2-intro_to_ind_project_questions.html">a2) Introduction to shroom</a>
    </li>
    <li>
      <a href="../articles/b-loading_the_shroom_package.html">b) Loading the shroom package</a>
    </li>
    <li>
      <a href="../articles/c-subsetting_a_dataframe_with_dplyr.html">c) Subsetting a dataframe with dplyr</a>
    </li>
    <li>
      <a href="../articles/d-summarizing_data_with_dplyr.html">d) Summarizing data with dplyr</a>
    </li>
    <li>
      <a href="../articles/f1-analysis_walkthrough_t_test_and_friends.html">f) Analysis walthrough: t-test and friends</a>
    </li>
    <li>
      <a href="../articles/f3-analysis_walkthrough_2-way_ANOVA.html">f3) Analysis walthrough: 2-way factorial ANOVA</a>
    </li>
    <li>
      <a href="../articles/f4-analysis_walkthrough_nested_ANOVA.html">f4) Analysis walthrough: Nested ANOVA</a>
    </li>
    <li>
      <a href="../articles/g1-calculating_effect_sizes_with_metafor.html">g) Calculating effect sizes using the metafor package</a>
    </li>
    <li>
      <a href="../articles/g2-analysis_of_difference_scores.html">f) Analysis of difference scores: thinking about effect sizes, sample sizes &amp; effect size variances</a>
    </li>
    <li>
      <a href="../articles/s1-stub-probablistic_index_models.html">s1) Stub - Probablistic index models</a>
    </li>
    <li>
      <a href="../articles/y-creating_a_package.html">w) Creating this package</a>
    </li>
    <li>
      <a href="../articles/z-build_and_rebuild_package.html">z) Building and rebuilding vignettes</a>
    </li>
    <li>
      <a href="../articles/z2-building_a_package.html">z2) Building and rebuilding vignettes - orig</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>f4) Analysis walthrough: Nested ANOVA</h1>
                        <h4 class="author">Nathan Brouwer</h4>
            
            <h4 class="date">2018-12-11</h4>
      
      
      <div class="hidden name"><code>f4-analysis_walkthrough_nested_ANOVA.Rmd</code></div>

    </div>

    
    
<p>THIS TUTORIAL HAS NOT BEEN FULLY SET UP AND PROBABLY MAKES NO SENSE!!!!!!!!!!!!!</p>
<p>NOTE to self: currently eval = FALSE is SET GLOBABLLY!</p>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>This tutorial walks through some types of analysis that can be done using the shroom package. In particular it looks at the situation when you have data that can be group by two seperate categorical variables. In our data, we will look at the impacts of both sex (male vs. female) and experimental group (control vs. mutation to candidation gene) on wing scores.</p>
<p>In the previous tutorial we used t-tests and similar analyses to look at just the impact of mutation (“experimental” flies) on wing scores of the female flies collected by one student, ignoring the males they collected. In this tutorial we will look at all of the flies collected by the same student.</p>
</div>
<div id="preliminaries" class="section level2">
<h2 class="hasAnchor">
<a href="#preliminaries" class="anchor"></a>Preliminaries</h2>
<div id="load-packages" class="section level3">
<h3 class="hasAnchor">
<a href="#load-packages" class="anchor"></a>Load packages</h3>
<p>Load the shroom package. You can download it with instal.packages(“shroom”) if you haven’t used it ever before. See “Loading the shroom package” for more information.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(shroom)</code></pre></div>
<p>Load other essential packages</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggpubr)  <span class="co">#plotting</span>
<span class="kw">library</span>(cowplot)

<span class="kw">library</span>(dplyr)   <span class="co">#data cleaning</span>

<span class="kw">library</span>(car)


<span class="kw">library</span>(bbmle)   <span class="co">#AIC taBLE</span>
<span class="kw">library</span>(lme4)
<span class="kw">library</span>(lawstat) <span class="co">#?</span>
<span class="kw">library</span>(effsize) <span class="co">#Cohen's dw</span></code></pre></div>
</div>
<div id="load-data" class="section level3">
<h3 class="hasAnchor">
<a href="#load-data" class="anchor"></a>Load data</h3>
<div id="loading-data-directly-from-the-shroom-package" class="section level4">
<h4 class="hasAnchor">
<a href="#loading-data-directly-from-the-shroom-package" class="anchor"></a>Loading data directly from the shroom package</h4>
<p>The data are internal to the package and so can be easily loaded.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">"wingscores"</span>)</code></pre></div>
</div>
</div>
</div>
<div id="cleaning-and-subsetting-the-wing-data" class="section level2">
<h2 class="hasAnchor">
<a href="#cleaning-and-subsetting-the-wing-data" class="anchor"></a>Cleaning and subsetting the wing data</h2>
<p>This information is covered in more detail in “Subsetting a dataframe with dplyr.”</p>
<div id="examine-raw-data" class="section level3">
<h3 class="hasAnchor">
<a href="#examine-raw-data" class="anchor"></a>Examine raw data</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(flies)
<span class="kw">names</span>(flies)
<span class="kw">head</span>(flies)</code></pre></div>
</div>
<div id="clean-the-raw-data" class="section level3">
<h3 class="hasAnchor">
<a href="#clean-the-raw-data" class="anchor"></a>Clean the raw data</h3>
<ul>
<li>Remove some un-needed columns using select().<br>
</li>
<li>Note “-” before each column name.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flies &lt;-<span class="st"> </span>flies <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>stock.num,
                          <span class="op">-</span>loaded,
                          <span class="op">-</span>file,
                          <span class="op">-</span>gene,
                          <span class="op">-</span>temp.C)</code></pre></div>
<p>Data frame now has fewer columns</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(flies)</code></pre></div>
</div>
</div>
<div id="data-analysis-1-way-anova" class="section level2">
<h2 class="hasAnchor">
<a href="#data-analysis-1-way-anova" class="anchor"></a>Data analysis: 1-way ANOVA</h2>
<div id="comparing-multiple-alleles-of-the-same-gene" class="section level3">
<h3 class="hasAnchor">
<a href="#comparing-multiple-alleles-of-the-same-gene" class="anchor"></a>Comparing multiple alleles of the same gene</h3>
<p>For each of our 6 candidate genes (abl, fhos, etc) we have 3 seperate alleles. Each allele is a different mutation that knocks out the gene in some way (point mutation, frameshift, large deletion of part of the chromosome encompassing the gene, etc). The reason we are looking at multiple alleles of each gene is to test whether the effects of knocking out a given gene are generalizable or specific to a particular mutant allele. If all 3 alleles have consistent effects, then that gives us confidence than we understand the biology of the gene and how it interacts with shroom.</p>
<p>There’s 2 ways we could look to see if the 3 alleles have a consistent effect. First, we could do a 3 seperate t-tests, one for each allele and count up the number of nominally “significant” tests. We have to keep in mind that the t-test is agnostic with regards to the direction of any differences and make sure we look at the data themselves. What we want is to have consistently significant differences all in the same direction (eg experimental flies all have lower scores), not just consistently significant differences (eg two alleles could have experimental flies with significantly lower scores, and the 3rd could have significantly higher scores).</p>
<p>Second, we could calculate the average effect of all of the mutations in this allele and see if it is significantly different from zero. The easiest way to do this would to calculate the difference between control and experimental flies for each allele, and then take the mean of those three alleles. Just taking the means, however, won’t get us confidence intervals or p-values; that will require a bit more stats. Below I’ll show different ways to calculate an average effect of mutating a gene and to calculate a confidence interval around that effect.</p>
</div>
<div id="subset-data-for-a-single-gene" class="section level3">
<h3 class="hasAnchor">
<a href="#subset-data-for-a-single-gene" class="anchor"></a>Subset data for a single gene</h3>
<p>First, we need data from a single class for all 3 alleles of one gene. Students in the class are organized in benches, and the 3 students sharing a bench all are working on the 3 alleles of a single gene.</p>
<p>Here, I’ll use the filter() command to take data for students 1, 2 and 3 who all sit next to each other work on the 3 alleles of the able gene. I’ll just consider the female flies.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">student123.F &lt;-<span class="st"> </span>flies <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(student.ID <span class="op">%in%</span><span class="st">  </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>) <span class="op">&amp;</span>
<span class="st">                                    </span>sex <span class="op">==</span><span class="st"> "F"</span>)</code></pre></div>
<p>These three students happened to look at 73 female flies.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(student123.F)</code></pre></div>
<p>These boxplots show that for 2 of the 3 genes, the experimental flies had lower wing scores than control flies. The 3rd allele had a very low sample size, as indicated by the lack of boxes in its box plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggboxplot</span>(<span class="dt">data =</span> student123.F,
            <span class="dt">y =</span> <span class="st">"wing.score"</span>,
            <span class="dt">x =</span> <span class="st">"E.or.C"</span>,
            <span class="dt">add =</span> <span class="st">"mean"</span>,
            <span class="dt">fill =</span> <span class="st">"E.or.C"</span>,
          <span class="dt">facet.by =</span> <span class="st">"allele"</span>)</code></pre></div>
</div>
<div id="calculate-effect-sizes-for-each-allele-by-hand" class="section level3">
<h3 class="hasAnchor">
<a href="#calculate-effect-sizes-for-each-allele-by-hand" class="anchor"></a>Calculate effect sizes for each allele by hand</h3>
<p>For a single allele, the difference between the mean of control flies and experimental flies can be thought of as the experimental effect, or the <strong>effect size.</strong> We can use dplyr group_by() and summarize() functions to get the means and other information on each of the 3 alleles.</p>
<p>Here I save the output of the dplyr functions to an object called “means.123”</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">means.<span class="dv">123</span> &lt;-<span class="st"> </span>student123.F <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(allele, E.or.C) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(wing.score),
            <span class="dt">n =</span> <span class="kw">n</span>(),
            <span class="dt">sd =</span> <span class="kw">sd</span>(wing.score),
            <span class="dt">SE =</span> <span class="kw">std.error</span>(wing.score))</code></pre></div>
<p>Note that the sample size varies a lot between alleles and also experimental vs. controls; there are always fewer experimental flies than controls.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">means.<span class="dv">123</span></code></pre></div>
<p>To calculate an effect size we want to subtract the mean of the experimental flies from the mean of the control flies. This will be easier if we re-orient out dataframe, putting all the “C” means in one column and all the “E” means in another. We can do this with the spread() function from the tidyr package.</p>
<p>(This is a bit tricky; Note that I also have to use the select() command to just grab the 3 columns that I want to feed into spread. Allele serves as the ID column, E.or.C has what will be the new column names, and mean has the values that will go into the new column names. I pretty bad at dplyr and tidyr actually - this took me 10 minutes to figure out).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">means.<span class="fl">123.</span>wide &lt;-<span class="st"> </span>means.<span class="dv">123</span> <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(allele, E.or.C, mean) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">spread</span>(<span class="dt">key =</span> E.or.C, <span class="dt">value =</span> mean)

means.<span class="fl">123.</span>wide</code></pre></div>
<p>Once we have the means side by side we can calculate the difference. There are several ways to do this; using the mutate() function is handy because it creates a new column for us on the fly.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">means.<span class="fl">123.</span>wide &lt;-<span class="st"> </span>means.<span class="fl">123.</span>wide <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">difference =</span> E<span class="op">-</span>C)

means.<span class="fl">123.</span>wide</code></pre></div>
<p>I can calculate the mean of the 3 differences and see that on average, mutating the able genes causes a reduction in the wing score of -0.84.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(means.<span class="fl">123.</span>wide<span class="op">$</span>difference)</code></pre></div>
<p>A fancy way we could get this same result is to build a linear model for the mean of the differences, using the “~1” notation to indicate “just give me the mean.” This is the format we use for “null” models which assume there are no differences between groups.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(<span class="kw">lm</span>(difference <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> means.<span class="fl">123.</span>wide))</code></pre></div>
<p>Under coefficients on the “(Intercept)” line in the “Estimate” column is -0.83, same as the mean above. We also get a standard error based on the standard deviation of these three data point.</p>
<p>One thing we saw above was that the same size varied a lot between E and C and between the alleles.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">means.<span class="dv">123</span>[,<span class="kw">c</span>(<span class="st">"allele"</span>, <span class="st">"n"</span>)]</code></pre></div>
<p>So, if we take just the mean of each group, calculate the difference, and take the mean of the three differences, we are ignoring that sample size impacts how precise our estimate of the mean is. In essence, we are treating a sample with 30 flies (abl[04674]) that same as one with 19 flies (Df(3L)ED223). Small sample sizes can result in biased estimate of the mean, and so treating all the sample sizes as if they were equal could through off our data. A reasonable alternative might be to give more weight to alleles with larger sample sizes and allow them to have more influence over the results.</p>
<p>A related issue is that the standard errors (SE) varied a lot between samples: from 0.15 to 0.39. Standard errors depend on both the sample size and the the standard deviation. The standard error tells you how precisely the mean has been estimated, and standard errors get bigger (indicating less precision) when sample sizes get small and standard deviations get bigger. Ignoring the different standard errors at play treats a precisely estimated mean the same as an imprecisely estimated one. A reasonable alternative might be to give alleles with smaller sample sizes more weight.</p>
</div>
</div>
<div id="weighted-regression" class="section level2">
<h2 class="hasAnchor">
<a href="#weighted-regression" class="anchor"></a>Weighted regression</h2>
<p>Let’s take a stab at correcting for differences in the variablity of samples. Will use the standard deviation for our weights.</p>
<p>Let’s reshape our data again, this time setting up the standard deviations into columns</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sd.<span class="fl">123.</span>wide &lt;-<span class="st"> </span>means.<span class="dv">123</span> <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(allele, E.or.C, sd) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">spread</span>(<span class="dt">key =</span> E.or.C, <span class="dt">value =</span> sd)

sd.<span class="fl">123.</span>wide</code></pre></div>
<p>We converted out two mean values into a difference through subtraction. We now want a weight value based on the standard devaition to go along with each difference. But we have two standard deviations for each allele. What we can do is take the simple average of them and use that as our weight. (We’d normally do a formal calculation of the <strong>pooled standard deviation</strong>, but that woudl take more math).</p>
<p>We can use the mutate function the take the mean of the C and E columns and their respective standard deviations</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sd.<span class="fl">123.</span>wide &lt;-<span class="st"> </span>sd.<span class="fl">123.</span>wide <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">sd.ave =</span> <span class="kw">mean</span>(<span class="kw">c</span>(C,E)))</code></pre></div>
<p>Now let’s make a little dataframe for our differences and weights. We’ll combine the important parts of the means.123.wide dataframe and the sd.123.wide dataframe</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">part1 &lt;-<span class="st"> </span>means.<span class="fl">123.</span>wide[,<span class="kw">c</span>(<span class="st">"allele"</span>,<span class="st">"difference"</span>)]
part2 &lt;-<span class="st">  </span>sd.<span class="fl">123.</span>wide[,<span class="kw">c</span>(<span class="st">"sd.ave"</span>)]

diffs.df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(part1,part2)

diffs.df</code></pre></div>
<p>Now, what we want to do is use the lm() function to calcualte the mean of the differences of the 3 alleles, while also doing some fancy-ish math to give different weights to each differene based on its standard deviation; the differences associated with small standard deivations will be given more influence over the final mean, and the differences associated with large standard deviations will be given less weight. To do this, we can use 1/SD as our weight. 1/(large sd) = small number = small weight. 1/(smaller sd) = larger number = larger weight.</p>
<p>We can asisgn these weights using the weight = arugement in R.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sd</span>(diffs.df.<span class="dv">2</span><span class="op">$</span>difference)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">es &lt;-<span class="st"> </span><span class="kw">escalc</span>(<span class="dt">measure =</span> <span class="st">"MD"</span>,
       mean<span class="op">/</span>sd <span class="op">~</span><span class="st"> </span>E.or.C<span class="op">|</span>allele,
       <span class="dt">weights =</span> n,
       <span class="dt">data =</span> means.<span class="dv">123</span>)

<span class="kw">rma</span>(es)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">escalc</span>(<span class="dt">mesure =</span> <span class="st">"MD"</span>,
       <span class="dt">m1i =</span> ,<span class="dt">m2i =</span> ,
       <span class="dt">data =</span> diffs.df.<span class="dv">2</span>,
       )</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(<span class="kw">lm</span>(difference <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, 
           <span class="dt">data =</span> diffs.df.<span class="dv">2</span>,
           <span class="dt">weights =</span> <span class="dv">1</span><span class="op">/</span>(<span class="fl">1.077465</span><span class="op">^</span><span class="dv">2</span><span class="op">+</span>pool.sd<span class="op">^</span><span class="dv">2</span>)))

diffs.df.<span class="dv">2</span><span class="op">$</span>pool.var &lt;-<span class="st"> </span>diffs.df.<span class="dv">2</span><span class="op">$</span>pool.sd<span class="op">^</span><span class="dv">2</span>
<span class="kw">rma</span>(<span class="dt">yi =</span> difference, <span class="dt">vi =</span> pool.var, <span class="dt">data =</span> diffs.df.<span class="dv">2</span>,
    <span class="dt">method =</span> <span class="st">"REML"</span>)</code></pre></div>
<p>This gives us an Estiamte of -0.92, which is somewhat more negative difference than -0.83 of the raw mean.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(<span class="kw">lm</span>(difference <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> means.<span class="fl">123.</span>wide))</code></pre></div>
</div>
<div id="nested-anova" class="section level2">
<h2 class="hasAnchor">
<a href="#nested-anova" class="anchor"></a>Nested ANOVA</h2>
<p>What is average effect of a mutation to abl?</p>
<p>Use lmer function from lme4</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lmm.Ho &lt;-<span class="st"> </span><span class="kw">lmer</span>(wing.score <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>allele),
     <span class="dt">data =</span> student123.F)

lmm.Ha &lt;-<span class="st"> </span><span class="kw">lmer</span>(wing.score <span class="op">~</span><span class="st"> </span>E.or.C <span class="op">+</span><span class="st"> </span>(E.or.C<span class="op">|</span>allele),
     <span class="dt">data =</span> student123.F)

<span class="kw">anova</span>(lmm.Ho,
      lmm.Ha)

<span class="kw">summary</span>(lmm.Ha)

<span class="kw">ranef</span>(lmm.Ha)

<span class="kw">fixef</span>(lmm.Ha)[<span class="dv">2</span>] <span class="op">+</span><span class="st"> </span><span class="kw">ranef</span>(lmm.Ha)<span class="op">$</span><span class="st">`</span><span class="dt">allele</span><span class="st">`</span>[,<span class="dv">2</span>]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(lmm.Ha)
<span class="kw">ranef</span>(lmm.Ha)</code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#preliminaries">Preliminaries</a></li>
      <li><a href="#cleaning-and-subsetting-the-wing-data">Cleaning and subsetting the wing data</a></li>
      <li><a href="#data-analysis-1-way-anova">Data analysis: 1-way ANOVA</a></li>
      <li><a href="#weighted-regression">Weighted regression</a></li>
      <li><a href="#nested-anova">Nested ANOVA</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by First Last.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
